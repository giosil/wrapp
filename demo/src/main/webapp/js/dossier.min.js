var GUI
!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.render=function(){return"<p>GUIEvents</p>"},e}(WUX.WComponent)
t.GUIEvents=e}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIPathologies")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning(t.I18.M_EDIT)
i.fpDetail.clear()
var s=WUX.getComponent("bxf")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("PATHOLOGIES.find",[i.fpFilter.getState()],function(n){if(i.status=i.iSTATUS_VIEW,i.tabResult.setState(n),i.selId){var s=e.indexOf(n,t.SYM_E.CODE,i.selId)
s>=0&&setTimeout(function(){i.tabResult.select([s])},100),i.selId=null}else n&&n.length?WUX.showSuccess(n.length+" "+t.I18.M_IFND):WUX.showWarning(t.I18.M_NFND)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.fpFilter.focus()}),this.tagsFilter=new WUX.WTags("tf"),this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpFilter.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpFilter.addComponent(t.SYM_E.TYPE,t.I18.L_TYPE,new t.SelSerType),this.fpFilter.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(e){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var n=i.tabResult.getSelectedRows()
if(!n||!n.length)return WUX.showWarning(t.I18.M_SEL),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning(t.I18.M_MOD),void i.btnSave.blur()
var s=i.fpDetail.checkMandatory(!0,!0,!1)
if(s)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_MAND+": "+s)
var a=i.fpDetail.getState(),l=e.getString(a,t.SYM_E.ID),r=e.getString(a,t.SYM_E.CODE)
jrpc.execute("PATHOLOGIES.exists",[r,l],function(e){if(e)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_ALRP)
i.isNew?jrpc.execute("PATHOLOGIES.insert",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_E.ID],i.fpFilter.clear(),i.fpFilter.setValue(t.SYM_E.CODE,e[t.SYM_E.CODE]),i.btnFind.trigger("click")}):jrpc.execute("PATHOLOGIES.update",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_E.ID]
var n=i.tabResult.getSelectedRows()
n&&n.length||i.btnFind.trigger("click")})})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){i.btnCancel.blur(),i.status==i.iSTATUS_EDITING&&WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew&&i.fpDetail.clear(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpDetail.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpDetail.addComponent(t.SYM_E.TYPE,t.I18.L_TYPE,new t.SelSerType),this.fpDetail.addInternalField(t.SYM_E.ID),this.fpDetail.enabled=!1,this.fpDetail.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.cntActions=new t.AppTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew)
var n=[[t.I18.L_CODE,t.SYM_E.CODE,"s"],[t.I18.L_DESC,t.SYM_E.DESC,"s"],[t.I18.L_TYPE,t.SYM_E.TYPE_DESC,"s"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.filter=!0,this.tabResult.exportFile="services",this.tabResult.types=e.col(n,2),this.tabResult.css({h:250,f:10}),this.tabResult.onSelectionChanged(function(n){var s=n.selectedRowsData[0]
if(s){var a=e.getString(s,t.SYM_E.ID)
a&&jrpc.execute("PATHOLOGIES.read",[a],function(t){i.fpDetail.clear(),i.fpDetail.setState(t)})}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox(t.I18.L_FILT+":","","","bxf",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section(t.I18.L_DET).add(this.fpDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n}(WUX.WComponent)
t.GUIPathologies=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(){function t(){}return t.ID="_id",t.CODE="code",t.FAMILY="family",t.NAME="name",t.BIRTHDATE="birthDate",t.GENDER="gender",t.EMAIL="email",t.PHONE="phone",t.TITLE="title",t}()
t.SYM_P=i
var n=function(){function t(){}return t.ID="_id",t.DATE="date",t.SERV="serv",t.STRU="stru",t.PATH="path",t.FARE="fare",t.AGRE="agre",t}()
t.SYM_H=n
var s=function(i){function s(s){var a=i.call(this,s,"DlgHistory")||this
a.title=t.I18.L_EVNS,a.fp=new WUX.WFormPanel(a.subId("fp")),a.fp.addRow(),a.fp.addDateField(n.DATE,t.I18.L_DATE),a.fp.addComponent(n.SERV,t.I18.L_SERV,new t.SelServices),a.fp.addCurrencyField(n.FARE,t.I18.L_FARE),a.fp.addRow(),a.fp.addComponent(n.STRU,t.I18.L_STRU,new t.SelStructures),a.fp.addComponent(n.PATH,t.I18.L_PATH,new t.SelPathologies),a.fp.addBlankField(),a.fp.setMandatory(n.DATE,n.SERV,n.STRU),a.btnAdd=new WUX.WButton(a.subId("ba"),t.TXT.ADD,"",WUX.BTN.SM_PRIMARY),a.btnAdd.on("click",function(e){var i=a.fp.checkMandatory(!0,!0,!0)
if(i)return void WUX.showWarning(t.I18.M_MAND+": "+i)
var n=a.fp.getState()
n.patient=a.props,jrpc.execute("EVENTS.insert",[n],function(e){if(!e||!e._id)return void WUX.showWarning(t.I18.M_KO)
var i=a.table.getState()
i||(i=[]),e.nfl=1,i.unshift(e),a.table.setState(i)})}),a.btnRes=new WUX.WButton(a.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_DANGER),a.btnRes.on("click",function(t){a.fp.clear(),a.fp.focus()})
var l=[[t.I18.L_DATE,n.DATE,"d"],[t.I18.L_SERV,n.SERV,"s"],[t.I18.L_STRU,n.STRU,"s"],[t.I18.L_AGRE,n.AGRE,"b"],[t.I18.L_PATH,n.PATH,"s"],[t.I18.L_FARE,n.FARE,"c"]]
return a.table=new WUX.WDXTable(a.subId("tah"),e.col(l,0),e.col(l,1)),a.table.types=e.col(l,2),a.table.css({h:400,f:10}),a.table.exportFile="events",a.table.filter=!0,a.table.onRowPrepared(function(t){if(t.data){e.getInt(t.data,"nfl")&&WUX.setCss(t.rowElement,WUX.CSS.WARNING)}}),a.table.addActions("_id",{id:"del",type:WUX.WInputType.Link,classStyle:"btn btn-link btn-xs",style:"text-danger",label:t.TXT.DELETE,icon:WUX.WIcon.TRASH}),a.table.onClickAction(function(t){var e=WUX.firstSub(t.currentTarget),i=WUX.lastSub(t.currentTarget)
console.log("[DlgHistory] onClickAction sub="+e,"eid="+i),"del"==e&&a.delete(i)}),a.body.addRow().addCol("col-xs-11 b-r").add(a.fp).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},a.btnAdd,a.btnRes).addRow().addCol("12").addDiv(8).add(a.table),a}return __extends(s,i),s.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.table&&this.table.setState(t)},s.prototype.getState=function(){return this.table?this.table.getState():[]},s.prototype.delete=function(i){var n=this
i&&jrpc.execute("EVENTS.delete",[i],function(s){if(s){var a=n.table.getState(),l=e.indexOf(a,"_id",i)
if(l<0)return
a.splice(l,1),n.table.setState(a)}else WUX.showWarning(t.I18.M_KO)})},s.prototype.onShown=function(){this.fp.clear(),this.fp.focus()},s}(WUX.WDialog)
t.DlgHistory=s
var a=function(n){function a(t){var e=n.call(this,t||"*","GUIPatients")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e.ckFlt=!1,e.dlgHist=new s(e.subId("dh")),e}return __extends(a,n),a.prototype.render=function(){var n=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(s){if(n.status==n.iSTATUS_EDITING)return void WUX.showWarning(t.I18.M_EDIT)
if(n.ckFlt){if(n.fpFilter.isBlank())return void WUX.showWarning(t.I18.M_CRIT)
var a=n.fpFilter.checkMandatory(!0,!0,!0)
if(a)return void WUX.showWarning(t.I18.M_MAND+": "+a)}n.fpDetail.clear()
var l=WUX.getComponent("bxf")
l instanceof WUX.WBox&&(n.tagsFilter.setState(n.fpFilter.getValues(!0)),l.collapse()),jrpc.execute("PATIENTS.find",[n.fpFilter.getState()],function(s){if(n.status=n.iSTATUS_VIEW,n.tabResult.setState(s),n.selId){var a=e.indexOf(s,i.CODE,n.selId)
a>=0&&setTimeout(function(){n.tabResult.select([a])},100),n.selId=null}else s&&s.length?WUX.showSuccess(s.length+" "+t.I18.M_IFND):WUX.showWarning(t.I18.M_NFND)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){n.fpFilter.clear(),n.tagsFilter.setState({}),n.tabResult.setState([]),n.fpDetail.clear(),n.fpFilter.focus()}),this.tagsFilter=new WUX.WTags("tf"),this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addTextField(i.FAMILY,t.I18.L_FAML),this.fpFilter.addTextField(i.NAME,t.I18.L_NAME),this.fpFilter.setMandatory(i.FAMILY,i.CODE),this.fpFilter.onEnterPressed(function(t){n.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(n.status==n.iSTATUS_EDITING)return void n.btnNew.blur()
n.isNew=!0,n.status=n.iSTATUS_EDITING,n.selId=null,n.tabResult.clearSelection(),n.fpDetail.enabled=!0,n.fpDetail.clear(),setTimeout(function(){n.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(e){if(n.status==n.iSTATUS_EDITING||n.status==n.iSTATUS_STARTUP)return void n.btnOpen.blur()
var i=n.tabResult.getSelectedRows()
if(!i||!i.length)return WUX.showWarning(t.I18.M_SEL),void n.btnOpen.blur()
n.isNew=!1,n.status=n.iSTATUS_EDITING,n.selId=null,n.fpDetail.enabled=!0,setTimeout(function(){n.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(s){if(n.status!=n.iSTATUS_EDITING)return WUX.showWarning(t.I18.M_MOD),void n.btnSave.blur()
var a=n.fpDetail.checkMandatory(!0,!0,!1)
if(a)return n.btnSave.blur(),void WUX.showWarning(t.I18.M_MAND+": "+a)
var l=n.fpDetail.getState(),r=e.getString(l,i.ID),o=e.getString(l,i.CODE)
jrpc.execute("PATIENTS.exists",[o,r],function(e){if(e)return n.btnSave.blur(),void WUX.showWarning(t.I18.M_ALRP)
n.isNew?jrpc.execute("PATIENTS.insert",[l],function(e){n.status=n.iSTATUS_VIEW,n.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),n.selId=e[i.ID],n.fpFilter.clear(),n.fpFilter.setValue(i.CODE,e[i.CODE]),n.btnFind.trigger("click")}):jrpc.execute("PATIENTS.update",[l],function(e){n.status=n.iSTATUS_VIEW,n.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),n.selId=e[i.ID]
var s=n.tabResult.getSelectedRows()
s&&s.length||n.btnFind.trigger("click")})})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){n.btnCancel.blur(),n.status==n.iSTATUS_EDITING&&WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(n.isNew&&n.fpDetail.clear(),n.status=n.iSTATUS_VIEW,n.fpDetail.enabled=!1,n.selId=null)})}),this.btnHist=new WUX.WButton(this.subId("bh"),t.I18.L_EVNS,t.ICO.DETAIL,WUX.BTN.ACT_OUTLINE_INFO),this.btnHist.on("click",function(t){n.showHistory()}),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(i.FAMILY,t.I18.L_FAML),this.fpDetail.addTextField(i.NAME,t.I18.L_NAME),this.fpDetail.addTextField(i.CODE,t.I18.L_CODE),this.fpDetail.addDateField(i.BIRTHDATE,t.I18.L_BIDT),this.fpDetail.addRow(),this.fpDetail.addTextField(i.TITLE,t.I18.L_TIT),this.fpDetail.addTextField(i.EMAIL,t.I18.L_MAIL),this.fpDetail.addTextField(i.PHONE,t.I18.L_PHON),this.fpDetail.addBlankField(),this.fpDetail.addInternalField(i.ID),this.fpDetail.enabled=!1,this.fpDetail.setMandatory(i.FAMILY,i.NAME),this.cntActions=new t.AppTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.left.add(this.btnHist),this.cntActions.right.add(this.btnNew)
var s=[[t.I18.L_FAML,i.FAMILY,"s"],[t.I18.L_NAME,i.NAME,"s"],[t.I18.L_BIDT,i.BIRTHDATE,"d"],[t.I18.L_CODE,i.CODE,"s"],[t.I18.L_MAIL,i.EMAIL,"s"],[t.I18.L_PHON,i.PHONE,"s"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(s,0),e.col(s,1)),this.tabResult.filter=!0,this.tabResult.exportFile="patients",this.tabResult.types=e.col(s,2),this.tabResult.css({h:250,f:10}),this.tabResult.onSelectionChanged(function(t){var s=t.selectedRowsData[0]
if(s){var a=e.getString(s,i.ID)
a&&jrpc.execute("PATIENTS.read",[a],function(t){n.fpDetail.clear(),n.fpDetail.setState(t)})}}),this.tabResult.onDoubleClick(function(t){n.showHistory()}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox(t.I18.L_FILT+":","","","bxf",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section(t.I18.L_DET).add(this.fpDetail),this.container},a.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},a.prototype.showHistory=function(){var t=this,i=this.tabResult.getSelectedRowsData()
if(i&&i.length){var n=e.getString(i[0],"_id")
n&&jrpc.execute("EVENTS.find",[{patient:n}],function(e){t.dlgHist.setProps(n),t.dlgHist.setState(e),t.dlgHist.show(t)})}},a}(WUX.WComponent)
t.GUIPatients=a}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIServices")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning(t.I18.M_EDIT)
i.fpDetail.clear()
var s=WUX.getComponent("bxf")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("SERVICES.find",[i.fpFilter.getState()],function(n){if(i.status=i.iSTATUS_VIEW,i.tabResult.setState(n),i.selId){var s=e.indexOf(n,t.SYM_P.CODE,i.selId)
s>=0&&setTimeout(function(){i.tabResult.select([s])},100),i.selId=null}else n&&n.length?WUX.showSuccess(n.length+" "+t.I18.M_IFND):WUX.showWarning(t.I18.M_NFND)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.fpFilter.focus()}),this.tagsFilter=new WUX.WTags("tf"),this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpFilter.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpFilter.addComponent(t.SYM_E.TYPE,t.I18.L_TYPE,new t.SelSerType),this.fpFilter.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(e){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var n=i.tabResult.getSelectedRows()
if(!n||!n.length)return WUX.showWarning(t.I18.M_SEL),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning(t.I18.M_MOD),void i.btnSave.blur()
var s=i.fpDetail.checkMandatory(!0,!0,!1)
if(s)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_MAND+": "+s)
var a=i.fpDetail.getState(),l=e.getString(a,t.SYM_P.ID),r=e.getString(a,t.SYM_P.CODE)
jrpc.execute("SERVICES.exists",[r,l],function(e){if(e)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_ALRP)
i.isNew?jrpc.execute("SERVICES.insert",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_P.ID],i.fpFilter.clear(),i.fpFilter.setValue(t.SYM_P.CODE,e[t.SYM_P.CODE]),i.btnFind.trigger("click")}):jrpc.execute("SERVICES.update",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_P.ID]
var n=i.tabResult.getSelectedRows()
n&&n.length||i.btnFind.trigger("click")})})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){i.btnCancel.blur(),i.status==i.iSTATUS_EDITING&&WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew&&i.fpDetail.clear(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpDetail.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpDetail.addComponent(t.SYM_E.TYPE,t.I18.L_TYPE,new t.SelSerType),this.fpDetail.addCurrencyField(t.SYM_E.FARE,t.I18.L_FARE),this.fpDetail.addInternalField(t.SYM_E.ID),this.fpDetail.enabled=!1,this.fpDetail.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.cntActions=new t.AppTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew)
var n=[[t.I18.L_CODE,t.SYM_E.CODE,"s"],[t.I18.L_DESC,t.SYM_E.DESC,"s"],[t.I18.L_TYPE,t.SYM_E.TYPE_DESC,"s"],[t.I18.L_FARE,t.SYM_E.FARE,"c"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.filter=!0,this.tabResult.exportFile="services",this.tabResult.types=e.col(n,2),this.tabResult.css({h:250,f:10}),this.tabResult.onSelectionChanged(function(n){var s=n.selectedRowsData[0]
if(s){var a=e.getString(s,t.SYM_P.ID)
a&&jrpc.execute("SERVICES.read",[a],function(t){i.fpDetail.clear(),i.fpDetail.setState(t)})}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox(t.I18.L_FILT+":","","","bxf",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section(t.I18.L_DET).add(this.fpDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n}(WUX.WComponent)
t.GUIServices=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){return i.call(this,t||"*","GUIStatEvents")||this}return __extends(n,i),n.prototype.render=function(){var i=this
return this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){var s=i.fpFilter.checkMandatory(!0,!0)
if(s)return WUX.showWarning(t.I18.M_MAND+": "+s),!1
var a=WUX.getComponent("boxFilter")
a instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),a.collapse()),jrpc.execute("STATISTICS.load",[i.fpFilter.getState()],function(n){if(e.isEmpty(n))return void WUX.showWarning(t.I18.M_NFND)
i.chrPE.setState(n.pe),i.chrPV.setState(n.pv),i.chrPP.setState(n.pp),i.chrGV.setState(n.gv),setTimeout(function(){i.fix()},200)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.chrPE.setState(null),i.chrPV.setState(null),i.chrPP.setState(null),i.chrGV.setState(null),i.fpFilter.clear(),i.tagsFilter.setState({})}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selMonth=new t.SelMonth,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent("code",t.I18.L_MONT,this.selMonth),this.fpFilter.addBlankField(),this.fpFilter.setMandatory("code"),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.chrPE=new WUX.WChartJS("chrpe","bar"),this.chrPV=new WUX.WChartJS("chrpv","bar"),this.chrPP=new WUX.WChartJS("chrpp","pie"),this.chrGV=new WUX.WChartJS("chrgv","line"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox(t.I18.L_FILT+":","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addRow().addCol("6").section(t.I18.L_DONE).add(this.chrPE).addCol("6").section(t.I18.L_VALU).add(this.chrPV).addRow().addCol("6").section(t.I18.L_COMP).add(this.chrPP).addCol("6").section(t.I18.L_TREN).add(this.chrGV),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.fix=function(){var t=this.chrPE.getRoot(),e=t.height()
e&&(this.chrPE.css({h:e,maxh:e}),this.chrPV.css({h:e,maxh:e}),this.chrPP.css({h:e,maxh:e}),this.chrGV.css({h:e,maxh:e}))},n}(WUX.WComponent)
t.GUIStatEvents=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIStructures")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning(t.I18.M_EDIT)
i.fpDetail.clear()
var s=WUX.getComponent("bxf")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("STRUCTURES.find",[i.fpFilter.getState()],function(n){if(i.status=i.iSTATUS_VIEW,i.tabResult.setState(n),i.selId){var s=e.indexOf(n,t.SYM_P.CODE,i.selId)
s>=0&&setTimeout(function(){i.tabResult.select([s])},100),i.selId=null}else n&&n.length?WUX.showSuccess(n.length+" "+t.I18.M_IFND):WUX.showWarning(t.I18.M_NFND)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.fpFilter.focus()}),this.tagsFilter=new WUX.WTags("tf"),this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpFilter.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpFilter.addBooleanField(t.SYM_E.AGRE,t.I18.L_AGRE),this.fpFilter.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(e){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var n=i.tabResult.getSelectedRows()
if(!n||!n.length)return WUX.showWarning(t.I18.M_SEL),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning(t.I18.M_MOD),void i.btnSave.blur()
var s=i.fpDetail.checkMandatory(!0,!0,!1)
if(s)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_MAND+": "+s)
var a=i.fpDetail.getState(),l=e.getString(a,t.SYM_P.ID),r=e.getString(a,t.SYM_P.CODE)
jrpc.execute("STRUCTURES.exists",[r,l],function(e){if(e)return i.btnSave.blur(),void WUX.showWarning(t.I18.M_ALRP)
i.isNew?jrpc.execute("STRUCTURES.insert",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_P.ID],i.fpFilter.clear(),i.fpFilter.setValue(t.SYM_P.CODE,e[t.SYM_P.CODE]),i.btnFind.trigger("click")}):jrpc.execute("STRUCTURES.update",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess(t.I18.M_OK),i.selId=e[t.SYM_P.ID]
var n=i.tabResult.getSelectedRows()
n&&n.length||i.btnFind.trigger("click")})})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){i.btnCancel.blur(),i.status==i.iSTATUS_EDITING&&WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew&&i.fpDetail.clear(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.SYM_E.CODE,t.I18.L_CODE),this.fpDetail.addTextField(t.SYM_E.DESC,t.I18.L_DESC),this.fpDetail.addBooleanField(t.SYM_E.AGRE,t.I18.L_AGRE),this.fpDetail.addInternalField(t.SYM_E.ID),this.fpDetail.enabled=!1,this.fpDetail.setMandatory(t.SYM_E.CODE,t.SYM_E.DESC,t.SYM_E.TYPE),this.cntActions=new t.AppTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew)
var n=[[t.I18.L_CODE,t.SYM_E.CODE,"s"],[t.I18.L_DESC,t.SYM_E.DESC,"s"],[t.I18.L_AGRE,t.SYM_E.AGRE,"b"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.filter=!0,this.tabResult.exportFile="structures",this.tabResult.types=e.col(n,2),this.tabResult.css({h:250,f:10}),this.tabResult.onSelectionChanged(function(n){var s=n.selectedRowsData[0]
if(s){var a=e.getString(s,t.SYM_P.ID)
a&&jrpc.execute("STRUCTURES.read",[a],function(t){i.fpDetail.clear(),i.fpDetail.setState(t)})}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox(t.I18.L_FILT+":","","","bxf",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section(t.I18.L_DET).add(this.fpDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n}(WUX.WComponent)
t.GUIStructures=i}(GUI||(GUI={}))
